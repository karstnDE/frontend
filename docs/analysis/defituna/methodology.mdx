---
title: DefiTuna Methodology
---

# DefiTuna Methodology

This page documents the analytical approaches specific to DefiTuna, a Solana DeFi protocol. For general methodology, see [Data Pipeline & Methodology](../methodology).

## Overview

DefiTuna analytics cover three main areas:

1. **Treasury Revenue Attribution** - Understanding where protocol revenue comes from
2. **Staking Analytics** - Tracking TUNA staking behavior and yields
3. **Usage Statistics** - Measuring user activity and engagement

Each area requires specialized approaches tailored to DefiTuna's unique characteristics.

---

## Treasury Revenue Attribution

### The Challenge

DefiTuna's treasury receives revenue in two forms:
1. **Direct SOL/WSOL** - Immediately measurable
2. **Other tokens** (USDC, JUP, TUNA, etc.) - Accumulated over time, then swapped to SOL

The analytical challenge: when tokens are eventually swapped to SOL, that SOL must be attributed back to the original revenue-generating activities that earned those tokens.

### The Ledger Approach

I track accumulated tokens across three dimensions:
- **Which token** - USDC, JUP, TUNA, etc.
- **Which pool** - Orca SOL-USDC, Fusion pools, etc.
- **Which activity** - Protocol fees, liquidity positions, etc.

When tokens get swapped to SOL, I calculate the conversion rate and proportionally attribute the resulting SOL back to each source. This ensures every SOL is traced to its origin.

### Example Flow

Here's how attribution works in practice:

**Day 1:**
- Protocol fees generate 100 USDC (from Orca SOL-USDC pool)
- Liquidity operations generate 50 USDC (from Orca SOL-USDC pool)
- Both amounts tracked in the ledger

**Day 2:**
- Treasury swaps 150 USDC → 0.75 SOL
- Conversion rate: 0.005 SOL per USDC
- Attribution:
  - Protocol fees: 100 × 0.005 = 0.5 SOL
  - Liquidity operations: 50 × 0.005 = 0.25 SOL
- Total: 0.75 SOL (matches swap output)

### Cross-Day Tracking

Token balances persist across days. Tokens earned in Week 1 but swapped in Week 2 are still attributed to Week 1's revenue activities. This prevents gaps and ensures complete accounting.

### Dual Verification

Two independent methods calculate total revenue:
1. **Simple count** - Sum all SOL inflows
2. **Attributed sum** - Sum all attributed SOL from the ledger

These must match within 0.01 SOL. Any discrepancy indicates an attribution error requiring investigation.

### 100% Accuracy Standard

The attribution system achieves complete accuracy by design. Every SOL flowing into the treasury is accounted for and attributed to its source. This verification happens automatically with each data update.

---

## Staking Analytics

DefiTuna's staking program allows TUNA holders to stake tokens and earn rewards. Staking analytics track participation, yields, and user behavior.

### Daily Balance Tracking

I monitor the staking program to track:
- **Total staked TUNA** - Amount currently staked across all users
- **Total unstaked TUNA** - Available supply not currently staked
- **Daily changes** - Net stake and unstake activity
- **Staker count** - Number of unique staking wallets

These metrics reveal staking participation trends over time.

### APY Calculations

Two APY metrics are calculated:

**Reference APR** - The protocol-wide staking return available to all stakers. Calculated from total rewards distributed divided by total staked amount.

**Your APR** - A user-specific return accounting for when someone stakes relative to reward distributions. Shows the actual return for different entry timings.

Both use on-chain reward data and actual staking balances, not estimates.

### Loyalty & Conviction Metrics

Stakers have two choices when rewards accrue:
- **Compound** - Restake rewards to increase position
- **Claim** - Withdraw rewards

I track this behavior across different staker sizes:
- **Mega stakers** - Over 10M TUNA staked
- **Large stakers** - 1-10M TUNA
- **Medium stakers** - 100K-1M TUNA
- **Small stakers** - Under 100K TUNA

Compound vs claim rates by cohort reveal conviction levels. Higher compound rates suggest stronger long-term belief.

### Wallet Timeline Analysis

For individual wallets, I track complete staking history:
- All stake and unstake events with amounts and dates
- Reward claim and compound actions
- Current position and duration
- Historical position sizes

This enables detailed wallet-level analysis visible on the [Wallet Timeline](../../staking/wallet-timeline) page.

---

## Usage Statistics

Usage analytics measure how actively the protocol is being used and by how many unique participants.

### User Definition

A "user" is a unique wallet address that signs transactions interacting with DefiTuna. I track signers rather than just recipients to focus on active participants.

### Activity Categories

**Stakers** - Wallets that stake, unstake, claim rewards, or compound. These represent committed users directly participating in the protocol's staking mechanism.

**Daily Active Users** - Wallets involved in revenue-generating activities like fee collection, position adjustments, liquidity operations, etc. Excludes pure token transfers.

### Tracking Approach

Daily: Count unique wallet addresses per activity type each day.

Weekly: Apply 7-day rolling windows to show sustained engagement over time rather than daily volatility.

**Top Wallets** - Rank wallets by total days active, weeks active, or transaction count to identify core users.

### No Bot Filtering

Currently no automated bot detection. The transparent data makes manual review straightforward if suspicious patterns appear.

---

## Data Quality Assurance

### Revenue Verification

Revenue totals are cross-checked against DefiTuna's own reporting where available. Any deviation over 0.001 SOL triggers investigation.

The dual verification system (simple count vs attributed sum) must agree. This mathematical check catches attribution errors automatically.

### Staking Validation

Staking balance calculations are validated against DefiTuna's staking treasury data when possible. Daily totals must reconcile with known staked amounts.

### Classification Completeness

Every transaction must be classified. Unclassified transactions indicate the classification system needs updating, triggering review and reprocessing.

### Historical Consistency

When analytical methods improve, all historical data is reprocessed. This ensures consistent standards across the entire time series, not just recent data.

---

## Update Schedule

Data updates run daily, typically processing the previous day's transactions. Each update:
1. Fetches new transactions
2. Classifies and attributes them
3. Updates aggregations
4. Validates against quality checks
5. Exports updated datasets

The "Last updated" timestamp in the site header shows when data was refreshed.

---

## Monitored Accounts

**Treasury PDA:** `G9XfJoY81n8A9bZKaJFhJYomRrcvFkuJ22em2g8rZuCh`

This is DefiTuna's primary treasury address where protocol revenue accumulates. All revenue analysis centers on transactions flowing through this address.

**Staking Program:** Transactions involving DefiTuna's staking contract are tracked for staking analytics.

**Key Tokens:**
- **SOL/WSOL** - Native Solana token
- **TUNA** - DefiTuna's protocol token
- **USDC, JUP** - Common revenue tokens

---

## What's Excluded

Not all treasury transactions represent revenue:

**Staking operations** - User deposits that remain withdrawable aren't counted as revenue. Only staking-related fees or rewards that accrue to the treasury qualify.

**Internal transfers** - Movements between treasury-controlled accounts don't represent new value.

**System transactions** - Protocol maintenance operations that don't generate value.

The classification system explicitly flags these transaction types to exclude them from revenue metrics while maintaining complete transaction history.

---

*DefiTuna analytics evolve as the protocol develops new features. Methodology updates maintain historical consistency through reprocessing rather than discontinuous changes.*
